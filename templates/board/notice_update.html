{% extends "base.html" %}
{% load static %}

{% block title %}공지 수정 | DORO LMS{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/notice_update.css' %}">
{% endblock %}

{% block content %}
<div id="canvas" class="notice-update">

  <!-- Hero 영역 -->
  <section class="hero hero--notice">
    <div class="hero__inner">
      <h1 class="hero__title">공지사항</h1>
      <p class="hero__subtitle">
        등록된 공지 사항의 내용을 수정합니다.
      </p>
    </div>
  </section>

  <!-- 메인 카드 -->
  <main class="notice-update-layout" role="main" aria-label="공지 수정">
    <section class="card notice-update-card">

      <header class="notice-update-card__header">
        <h2 class="notice-update-card__title">공지 수정</h2>
      </header>

      <form method="post" class="notice-update-form">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="form-errors">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <!-- 1줄: 분류 / 대상 / 제목 -->
        <div class="notice-update-row">

          <!-- 분류: 공지 / 점검 (UI 전용) -->
          <div class="field-group">
            <label for="notice_type" class="field-label">분류</label>
            <select id="notice_type" name="notice_type" class="field-control field-select">
              <option value="NOTICE">공지</option>
              <option value="MAINT">점검</option>
            </select>
          </div>

          <!-- 대상: 전체 / 학생 / 강사 (UI 전용) -->
          <div class="field-group">
            <label for="notice_target" class="field-label">대상</label>
            <select id="notice_target" name="notice_target" class="field-control field-select">
              <option value="ALL">전체</option>
              <option value="STUDENT">학생</option>
              <option value="TEACHER">강사</option>
            </select>
          </div>

          <!-- 제목 (실제 필드) -->
          <div class="field-group field-group--grow">
            <label for="notice_title" class="field-label">{{ form.title.label }}</label>
            <input
              id="notice_title"
              name="{{ form.title.name }}"
              type="text"
              class="field-control field-input"
              placeholder="공지 제목을 입력하세요."
              value="{{ form.title.value|default_if_none:'' }}"
            >
            {% if form.title.errors %}
              <p class="field-error">{{ form.title.errors.0 }}</p>
            {% endif %}
          </div>
        </div>

        <!-- 에디터 영역 -->
        <div class="editor-shell">
          <div class="editor-toolbar">
            <div class="editor-toolbar__left" aria-hidden="true">
              <img src="{% static 'img/editor_toolbar_sample.png' %}"
                   alt=""
                   class="editor-toolbar__img">
            </div>
          </div>

          <textarea
            id="notice_content"
            name="{{ form.content.name }}"
            class="editor-body"
            placeholder="공지 내용을 입력하세요.">{{ form.content.value|default_if_none:'' }}</textarea>
          {% if form.content.errors %}
            <p class="field-error">{{ form.content.errors.0 }}</p>
          {% endif %}
        </div>

        <!-- 상단 고정 -->
        <div class="notice-update-pinned">
          <label class="pinned-label">
            {{ form.is_pinned }}
            <span>{{ form.is_pinned.label }}</span>
          </label>
        </div>

        <!-- 하단 버튼 -->
        <div class="notice-update-footer">
          <a href="{% url 'board:notice_detail' notice.notice_id %}"
             class="btn-secondary notice-update__cancel">
            취소
          </a>
          <button type="submit"
                  class="btn-primary notice-update__submit">
            수정 완료
          </button>
        </div>
      </form>
    </section>

    <!-- ✅ 수정 완료 토스트 -->
    <div class="update-toast" id="update-toast" aria-hidden="true">
      <div class="update-toast__box">
        <div class="update-toast__icon-circle">
          <span class="update-toast__icon-mark">!</span>
        </div>
        <p class="update-toast__message">수정이 완료되었습니다.</p>
        <button type="button"
                class="update-toast__btn"
                id="update-toast-confirm">
          확인
        </button>
      </div>
    </div>

  </main>

  <!-- 토스트 제어 스크립트 -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.querySelector('.notice-update-form');
      const submitBtn = document.querySelector('.notice-update__submit');
      const toast = document.getElementById('update-toast');
      const toastConfirm = document.getElementById('update-toast-confirm');

      if (!form || !submitBtn || !toast || !toastConfirm) return;

      // JS 켜져 있을 때만 기본 submit 막기
      submitBtn.type = 'button';

      submitBtn.addEventListener('click', function () {
        toast.classList.add('is-visible');
      });

      toastConfirm.addEventListener('click', function () {
        toast.classList.remove('is-visible');
        form.submit();  // 실제 폼 전송
      });
    });
  </script>

</div>
{% endblock %}
